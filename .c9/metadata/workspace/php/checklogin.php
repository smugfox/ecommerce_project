{"changed":false,"filter":false,"title":"checklogin.php","tooltip":"/php/checklogin.php","value":"<?php\r\n\r\ninclude_once('jcart/jcart.php');\r\n\r\nsession_start();\r\n?>\r\n\r\n<?php\r\n// Connect to server and select databse.\r\n    \r\n    if (isset($_POST['email']) and isset($_POST['password'])){\r\n        \r\n    // email and password sent from form \r\n    $email=$_POST['email']; \r\n    $password = $_POST[\"password\"];\r\n    $hashedPassword = crypt($password,'saltkey');\r\n    $con=mysqli_connect(\"127.13.131.1\",\"smugfox\",\"\",\"eshop\");\r\n\r\n    // Check connection\r\n    if (mysqli_connect_errno()) {\r\n        echo \"Failed to connect to MySQL: \" . mysqli_connect_error();\r\n    }\r\n \r\n    $result=mysqli_query($con,\"SELECT * FROM Customers WHERE Email='\" . $email . \"' and Password='\" . $hashedPassword . \"';\");\r\n    $row = mysqli_fetch_array($result);\r\n    // Mysql_num_row is counting table row\r\n    $count=mysqli_num_rows($result);\r\n    //$count = $result->num_rows;\r\n\r\n\r\n\r\n    // If result matched $my_email_address and $mypassword, table row must be 1 row\r\n    if($count==1){\r\n        $_SESSION['email'] = $email;\r\n        $_SESSION['CustomerID'] = $row['ID'];\r\n        // Register $my_email_address, $mypassword and redirect to file \"login_success.php\"\r\n        //session_register(\"my_email_address\");\r\n        //session_register(\"mypassword\"); \r\n        //echo \"Success!\";\r\n        //header(\"location:login_success.php\");\r\n    }\r\n        else {\r\n    \r\n        echo \"<p><label style='color:red;font-weight:bold;'>Invalid Login Credentials.</h6></p>\";\r\n        }\r\n    }\r\n    if (isset($_SESSION['email'])){\r\n        //header(\"location:login_success.php\");\r\n        header(\"location:index.php\");\r\n        }\r\n    else\r\n    {\r\n        header(\"location:registration.php\");\r\n    }\r\n\r\n?>","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":0,"scrollleft":6,"selection":{"start":{"row":6,"column":0},"end":{"row":6,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1405371084194}